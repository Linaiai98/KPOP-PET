# 虚拟宠物AI人设功能使用指南

## 🎭 功能概述

虚拟宠物系统现在支持自定义人设功能，通过集成SillyTavern的AI API，你的宠物可以根据你设定的人设和当前状态生成个性化的回复，让互动更加生动有趣！

## ✨ 新增功能

### 1. 自定义人设
- 在设置页面添加了"宠物人设"输入框
- 支持最多500字符的详细人设描述
- 人设会影响宠物的所有互动回复

### 2. AI动态回复
- 喂食、玩耍、休息时会根据人设生成个性化回复
- 考虑当前宠物状态（健康、快乐、饥饿、精力）
- 包含时间信息（上午、下午、晚上）

### 3. 智能回退机制
- 如果SillyTavern API不可用，自动使用默认回复
- API调用失败时有完善的错误处理
- 超时保护（8秒超时）

## 🚀 使用方法

### 第一步：设置宠物人设
1. 点击🐾浮动按钮打开虚拟宠物界面
2. 点击"⚙️ 设置"按钮
3. 在"宠物人设"文本框中输入你想要的人设描述
4. 点击"💾 保存设置"

### 第二步：体验AI回复
1. 返回主界面
2. 点击"🍖 喂食"、"🎾 玩耍"或"😴 休息"按钮
3. 观察宠物的个性化回复

## 📝 人设示例

### 高冷猫咪
```
一只高冷但内心温柔的猫，喜欢被投喂，但嘴上不承认。说话傲娇，经常用"哼"开头，偶尔会露出可爱的一面。
```

### 活泼小狗
```
一只活泼可爱的小狗，总是充满活力，喜欢和主人玩耍。说话热情洋溢，经常用感叹号，喜欢撒娇。
```

### 优雅龙族
```
一只优雅的龙，说话古典文雅，有着高贵的气质。喜欢用文言文或古风词汇，举止优雅，但内心其实很温暖。
```

### 害羞兔子
```
一只害羞的兔子，说话轻声细语，容易脸红。性格温柔内向，喜欢用"..."和颜文字，偶尔会结巴。
```

### 聪明鹦鹉
```
一只聪明的鸟，喜欢说俏皮话，有时会调皮捣蛋。说话机智幽默，喜欢用双关语和小聪明。
```

## 🔧 技术特性

### API集成
- 自动检测SillyTavern API可用性
- 支持多种API调用方式：
  - `window.generateReply()`
  - `window.SillyTavern.generateReply()`
  - `window.Generate()`
  - 内部API调用

### Prompt构建
- 动态构建包含以下信息的Prompt：
  - 宠物基本信息（名称、类型、等级）
  - 自定义人设
  - 当前状态（健康、快乐、饥饿、精力）
  - 用户行为（喂食、玩耍、休息）
  - 时间信息（上午、下午、晚上）

### 错误处理
- 超时保护（8秒）
- API不可用时的回退机制
- 加载状态显示
- 详细的错误日志

## 🧪 测试功能

在浏览器控制台中可以使用以下命令进行测试：

### 检查AI功能状态
```javascript
testVirtualPetAI()
```

### 手动测试AI回复
```javascript
testAIReply('feed')  // 测试喂食回复
testAIReply('play')  // 测试玩耍回复
testAIReply('sleep') // 测试休息回复
```

### 测试不同人设效果
```javascript
testPersonalities()
```

## 📊 数据版本

- 数据版本已升级到2.1
- 自动迁移旧版本数据
- 保留所有原有设置和进度

## 🎯 使用建议

1. **人设要具体**：描述越详细，AI回复越个性化
2. **包含性格特点**：如"高冷"、"活泼"、"害羞"等
3. **添加说话习惯**：如"喜欢用感叹号"、"经常说'哼'"
4. **考虑互动方式**：描述宠物如何回应不同行为
5. **保持一致性**：确保人设前后一致，避免矛盾

## 🔍 故障排除

### AI回复不工作？
1. 检查SillyTavern是否正常运行
2. 确认已连接AI模型
3. 在控制台运行`testVirtualPetAI()`检查状态

### 回复太慢？
- AI生成需要时间，请耐心等待
- 超过8秒会自动超时并使用默认回复

### 回复不符合人设？
- 尝试更详细地描述人设
- 确保人设描述清晰明确
- 可以多次测试调整人设内容

## 🎉 享受你的AI宠物！

现在你的虚拟宠物拥有了独特的个性，每次互动都会带来惊喜。快去设置一个有趣的人设，体验全新的AI互动吧！
