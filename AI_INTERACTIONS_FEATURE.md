# 虚拟宠物系统 - AI智能互动功能

## 🎮 功能介绍

AI智能互动功能是虚拟宠物系统的革命性升级！现在每一次与宠物的互动（喂食、玩耍、休息、升级、问候）都可以通过AI生成个性化、独特的回应，让您的宠物真正"活"起来！

## ✨ 核心特性

### 1. 全方位AI互动
- **喂食回应**：宠物会根据人设表达对食物的喜爱和感谢
- **玩耍回应**：展现兴奋和快乐的个性化表达
- **休息回应**：温柔舒适的感谢和满足
- **升级庆祝**：兴奋的成长喜悦和对主人的感谢
- **问候消息**：打开界面时的亲切问候

### 2. 智能内容生成
- **个性化定制**：严格按照宠物人设生成符合角色的回应
- **长度控制**：自动控制在25-30字以内，简洁有力
- **情感丰富**：根据互动类型表达不同的情感状态
- **每次不同**：同样的互动，每次都有新的惊喜

### 3. 无缝集成体验
- **智能回退**：AI失败时自动使用默认消息，确保体验流畅
- **视觉标识**：AI生成的消息带有✨特殊标识
- **延长显示**：AI消息显示时间更长，让您充分感受
- **完美融合**：与原有功能完美结合，不影响正常使用

## 🎭 互动类型详解

### 🍽️ 喂食互动 (feed)
**触发时机**：点击"喂食"按钮成功喂食后

**AI提示模板**：
```
现在主人给你喂食了！你感到很开心和满足。请生成一句表达感谢和开心的话语，要求：
1. 不超过25个字
2. 体现你对食物的喜爱和对主人的感谢
3. 符合你的性格特点
4. 语气要开心满足
```

**示例回应**：
- 猫咪："喵~ 这个好香呀！谢谢主人，我最喜欢你了！"
- 小狗："汪汪！主人做的食物最棒了，我好幸福！"
- 龙："吼~ 伟大的主人，这美食让吾倍感温暖！"

### 🎾 玩耍互动 (play)
**触发时机**：点击"玩耍"按钮成功玩耍后

**AI提示模板**：
```
现在主人和你一起玩耍！你感到非常兴奋和快乐。请生成一句表达兴奋和快乐的话语...
```

**示例回应**：
- 猫咪："喵呜~ 和主人一起玩真是太开心了！"
- 小狗："汪！我们再玩一次好不好？这太有趣了！"
- 兔子："蹦蹦~ 主人，我们跳得好高呀！"

### 😴 休息互动 (sleep)
**触发时机**：点击"休息"按钮成功休息后

**AI提示模板**：
```
现在主人让你休息睡觉！你感到很舒适和安心。请生成一句表达舒适和感谢的话语...
```

**示例回应**：
- 猫咪："喵~ 在主人身边睡觉最安心了..."
- 小狗："汪... 主人晚安，我会做美梦的！"
- 龙："吼... 有主人守护，吾可安然入眠..."

### 🎉 升级庆祝 (levelup)
**触发时机**：宠物升级时

**AI提示模板**：
```
你刚刚升级了！现在是X级！你感到非常兴奋和自豪。请生成一句表达兴奋和成就感的话语...
```

**示例回应**：
- 猫咪："喵呜！我变强了！都是主人照顾得好！"
- 小狗："汪汪！我升级啦！主人，我会更加努力的！"
- 龙："吼！吾之力量又有精进，感谢主人的栽培！"

### 👋 问候互动 (greeting)
**触发时机**：打开宠物界面时

**AI提示模板**：
```
主人刚刚打开了你的界面来看你！你感到很开心被关注。请生成一句问候和表达开心的话语...
```

**示例回应**：
- 猫咪："喵~ 主人来看我了！我好想你呀！"
- 小狗："汪汪！主人回来了！我等你好久了！"
- 小鸟："啾啾~ 主人，我想为你唱首歌！"

## 🛠️ 使用方法

### 基础使用
1. **确保AI撒娇功能已启用**：AI互动使用相同的人设系统
2. **启用AI互动功能**：默认启用，也可手动控制
3. **正常互动**：像往常一样喂食、玩耍、休息
4. **享受惊喜**：每次互动都有个性化的AI回应！

### 功能控制

#### 启用/禁用AI互动
```javascript
// 启用AI互动
toggleAIInteractions(true)

// 禁用AI互动（回到默认消息）
toggleAIInteractions(false)

// 切换状态
toggleAIInteractions()
```

#### 测试AI互动
```javascript
// 测试特定类型的互动
testAIInteraction('feed')     // 测试喂食回应
testAIInteraction('play')     // 测试玩耍回应
testAIInteraction('sleep')    // 测试休息回应
testAIInteraction('levelup')  // 测试升级庆祝
testAIInteraction('greeting') // 测试问候消息

// 批量测试所有互动类型
testAllAIInteractions()
```

#### 查看状态
```javascript
// 查看完整状态（包含AI互动状态）
checkAttentionStatus()
```

### 人设优化建议

为了获得更好的AI互动效果，建议在人设中：

1. **明确性格特点**：详细描述宠物的性格、喜好、行为习惯
2. **指定语言风格**：说明特殊用词、语气、表达方式
3. **情感表达方式**：描述如何表达开心、感谢、兴奋等情感
4. **互动偏好**：说明对不同互动的反应和喜好

**优化示例**：
```javascript
setPetPersona(`你是一只活泼可爱的猫娘，名字叫${petData.name}。你的特点：
- 性格：活泼可爱，有点小调皮，但很依恋主人
- 语言：喜欢用"nya~"、"主人大人"等萌萌的词汇
- 情感：开心时会蹦蹦跳跳，感谢时会害羞，兴奋时会转圈圈
- 喜好：最爱吃小鱼干，喜欢和主人玩毛线球，睡觉时喜欢蜷成一团
- 表达：会用各种可爱的动作和声音来表达情感

在不同互动中的表现：
- 喂食时：会开心地"nya~"叫，表达对食物的喜爱
- 玩耍时：会兴奋地蹦跳，邀请主人继续玩
- 休息时：会满足地打呼噜，感谢主人的关怀
- 升级时：会自豪地展示自己的成长
- 见到主人时：会撒娇地蹭过来表达想念`)
```

## 🔧 技术实现

### 提示词工程
- **分类处理**：为每种互动类型设计专门的提示词模板
- **上下文注入**：将宠物人设和当前状态注入提示词
- **约束控制**：严格控制生成内容的长度和风格
- **质量保证**：多重验证确保生成内容符合要求

### 性能优化
- **异步处理**：所有AI调用都是异步的，不阻塞用户操作
- **错误恢复**：完善的错误处理和回退机制
- **防重复调用**：避免短时间内重复生成相同内容
- **智能缓存**：未来可考虑添加智能缓存机制

### 兼容性保证
- **向后兼容**：完全兼容原有功能，可随时禁用
- **渐进增强**：AI功能作为增强体验，不影响核心功能
- **优雅降级**：API失败时自动回退到默认消息

## 🎯 最佳实践

### 人设编写
1. **详细但不冗长**：提供足够的细节，但控制在2000字以内
2. **一致性**：确保人设描述前后一致，避免矛盾
3. **个性化**：突出宠物的独特性格和特点
4. **情感丰富**：描述多种情感状态的表达方式

### 功能使用
1. **渐进体验**：先使用默认人设，再逐步自定义
2. **测试验证**：设置新人设后先测试效果
3. **适度调整**：根据生成效果微调人设描述
4. **备份重要人设**：保存满意的人设配置

### 故障排除
1. **检查API状态**：确保SillyTavern的AI功能正常
2. **验证人设内容**：确保人设描述清晰合理
3. **查看控制台日志**：检查详细的错误信息
4. **使用测试功能**：通过测试命令验证功能状态

## 🔮 未来展望

### 计划功能
1. **情境感知**：根据宠物当前状态调整回应风格
2. **记忆系统**：记住之前的互动，生成连贯的对话
3. **情感进化**：随着互动增加，宠物性格逐渐丰富
4. **多轮对话**：支持连续的对话交流

### 用户建议
- 分享您的创意人设和有趣的AI回应
- 提供功能改进建议和使用反馈
- 参与社区讨论，交流使用心得

---

**让每一次互动都成为独特的惊喜！** 🎮✨
