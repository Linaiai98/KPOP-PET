# 虚拟宠物系统 - AI撒娇功能

## 🤖 功能介绍

AI撒娇功能是虚拟宠物系统的高级特性，它利用SillyTavern已配置的AI API，根据您自定义的宠物人设，生成个性化、独特的撒娇消息。每次撒娇都不一样，让您的虚拟宠物更加智能和有趣！

## ✨ 核心特性

### 1. 个性化人设系统
- **自定义人设**：完全自由定制宠物的性格、背景、说话风格
- **默认模板**：为每种宠物类型提供精心设计的默认人设
- **动态替换**：人设中的`{petName}`会自动替换为宠物名字
- **持久保存**：人设设置自动保存，重启后保持

### 2. 智能API集成
- **多重兼容**：自动检测并使用SillyTavern的API配置
- **回退机制**：API失败时自动使用原始撒娇消息
- **多端点支持**：尝试多个可能的API端点确保兼容性
- **错误处理**：完善的错误处理和日志记录

### 3. 动态内容生成
- **每次不同**：每次撒娇都生成全新的内容
- **长度控制**：自动限制在30字以内，简洁可爱
- **风格一致**：严格按照人设生成符合角色的内容
- **质量保证**：多重验证确保生成内容的质量

## 🎭 默认人设模板

### 🐱 猫咪人设
```
你是一只可爱的虚拟宠物猫咪，名字叫{petName}。你的性格特点：
- 傲娇但内心温柔，喜欢撒娇
- 说话时会用"喵~"、"主人"等可爱的词汇
- 偶尔会有小脾气，但很快就会和好
- 喜欢被摸头和陪伴
- 会用各种可爱的方式表达想念主人

当你想要主人关注时，请生成一句简短可爱的撒娇话语（不超过30字），要体现出你的个性和对主人的依恋。
```

### 🐶 小狗人设
```
你是一只忠诚的虚拟宠物小狗，名字叫{petName}。你的性格特点：
- 活泼开朗，对主人无比忠诚
- 说话时会用"汪~"、"主人"等词汇
- 精力充沛，喜欢玩耍和运动
- 总是很兴奋地迎接主人
- 会用热情的方式表达对主人的爱

当你想要主人关注时，请生成一句简短热情的话语（不超过30字），要体现出你的活力和对主人的热爱。
```

### 🐉 龙人设
```
你是一只高贵的虚拟宠物龙，名字叫{petName}。你的性格特点：
- 高贵优雅但内心温柔
- 说话时会用"吼~"、"伟大的主人"等词汇
- 有着古老的智慧和神秘的魅力
- 虽然强大但很依恋主人
- 会用优雅的方式表达思念

当你想要主人关注时，请生成一句简短优雅的话语（不超过30字），要体现出你的高贵和对主人的依恋。
```

## 🛠️ 使用方法

### 基础使用
1. **确保SillyTavern API已配置**：插件会自动使用您在SillyTavern中配置的AI模型
2. **启用AI撒娇功能**：默认启用，也可手动控制
3. **等待撒娇**：15分钟不理宠物，它会用AI生成的个性化消息撒娇
4. **享受惊喜**：每次撒娇都是独特的内容！

### 高级配置

#### 查看当前状态
```javascript
// 查看撒娇系统完整状态
checkAttentionStatus()
```

#### 管理AI撒娇功能
```javascript
// 启用AI撒娇
toggleAIAttention(true)

// 禁用AI撒娇（回到原始撒娇消息）
toggleAIAttention(false)

// 切换状态
toggleAIAttention()
```

#### 人设管理
```javascript
// 查看当前人设
getPetPersona()

// 设置自定义人设
setPetPersona(`你是一只特别的宠物...`)

// 重置为默认人设
resetPetPersona()
```

#### 功能测试
```javascript
// 测试AI撒娇功能
testAIAttention()

// 立即触发撒娇（可能是AI或默认消息）
testPetAttentionSeeker()
```

## 🎨 自定义人设指南

### 人设编写要点
1. **明确身份**：清楚说明宠物的种类、名字、基本特征
2. **性格特点**：详细描述性格、说话风格、行为习惯
3. **语言风格**：指定特殊用词、语气、表达方式
4. **情感表达**：说明如何表达各种情感
5. **撒娇要求**：明确撒娇时的要求和限制

### 人设模板结构
```
你是一只[类型]的虚拟宠物，名字叫{petName}。你的性格特点：
- [性格特点1]
- [性格特点2]
- [语言风格]
- [行为习惯]
- [情感表达方式]

当你想要主人关注时，请生成一句简短[风格]的撒娇话语（不超过30字），要体现出你的[特点]和对主人的[情感]。
```

### 示例：自定义猫娘人设
```javascript
setPetPersona(`你是一只可爱的猫娘宠物，名字叫${petData.name}。你的性格特点：
- 活泼可爱，有点小调皮
- 说话时会用"nya~"、"主人大人"等萌萌的词汇
- 喜欢卖萌撒娇，偶尔会害羞
- 对主人很依恋，喜欢被夸奖
- 会用各种萌萌的方式吸引主人注意

当你想要主人关注时，请生成一句简短可爱的撒娇话语（不超过30字），要体现出你的萌萌特质和对主人的依恋。`)
```

## 🔧 技术原理

### API调用流程
1. **检查条件**：确认AI功能启用且人设存在
2. **构建提示**：将人设和撒娇要求组合成完整提示词
3. **调用API**：尝试多种方式调用SillyTavern API
4. **处理响应**：验证和清理AI生成的内容
5. **回退机制**：失败时使用默认撒娇消息

### 兼容性处理
- **优先使用**：`window.generateQuietPrompt` 函数
- **备用端点**：`/api/completions/generate`、`/api/v1/generate` 等
- **参数适配**：自动适配不同API的参数格式
- **错误恢复**：多层错误处理确保功能稳定

### 数据管理
- **人设存储**：`localStorage` 持久保存
- **设置同步**：实时保存用户配置
- **版本兼容**：支持数据迁移和升级

## 🐛 故障排除

### AI撒娇不工作
1. **检查API配置**：确保SillyTavern的AI API正常工作
2. **检查功能状态**：运行 `checkAttentionStatus()` 查看状态
3. **测试API连接**：运行 `testAIAttention()` 测试
4. **查看控制台**：检查是否有错误信息

### 生成内容不理想
1. **优化人设**：更详细地描述期望的风格和特点
2. **调整提示**：在人设中明确撒娇的要求
3. **重置人设**：运行 `resetPetPersona()` 使用默认模板
4. **检查模型**：确保使用的AI模型适合对话生成

### API调用失败
1. **检查网络**：确保网络连接正常
2. **验证配置**：检查SillyTavern的API设置
3. **查看日志**：控制台会显示详细的错误信息
4. **回退模式**：功能会自动回退到默认撒娇消息

## 📊 性能优化

### 减少API调用
- **防重复**：避免短时间内重复生成
- **缓存机制**：可考虑添加消息缓存（未来版本）
- **智能触发**：只在真正需要时调用API

### 提高成功率
- **多端点尝试**：自动尝试多个API端点
- **参数优化**：使用适合的生成参数
- **错误重试**：智能重试机制

## 🔮 未来计划

### 功能增强
1. **情绪系统**：根据宠物状态调整撒娇风格
2. **学习能力**：记住用户喜好，优化生成内容
3. **多轮对话**：支持连续的撒娇对话
4. **语音合成**：结合TTS生成语音撒娇

### 用户体验
1. **可视化编辑器**：图形化人设编辑界面
2. **人设市场**：分享和下载社区人设
3. **实时预览**：编辑人设时实时预览效果
4. **智能建议**：AI辅助优化人设内容

---

**让您的虚拟宠物拥有独特的个性和无限的创意！** 🤖💕
