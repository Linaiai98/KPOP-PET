<div id="virtual-pet-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>🐾 虚拟宠物系统</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- 状态指示器 -->
            <div class="flex-container" style="margin-bottom: 10px;">
                <div id="virtual-pet-status-indicator" style="display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(40, 167, 69, 0.1); border-radius: 4px; border-left: 4px solid #28a745;">
                    <span style="color: #28a745;">●</span>
                    <span style="font-size: 0.9em;">系统运行正常</span>
                    <span id="virtual-pet-api-status" style="margin-left: auto; font-size: 0.8em; color: #888;">API: 未检测</span>
                </div>
            </div>

            <!-- 基本开关 -->
            <div class="flex-container">
                <label class="checkbox_label" for="virtual-pet-enabled-toggle">
                    <input id="virtual-pet-enabled-toggle" type="checkbox" checked>
                    <span>启用虚拟宠物系统</span>
                </label>
            </div>
            <small class="notes">
                启用后会在屏幕上显示一个可拖动的宠物按钮（🐾）
            </small>

            <hr style="margin: 15px 0; border: none; border-top: 1px solid #444;">

            <!-- 人设配置 -->
            <div class="flex-container">
                <label for="virtual-pet-personality-select" style="display: block; margin-bottom: 8px; font-weight: bold;">
                    🎭 宠物人设选择
                </label>
                <select id="virtual-pet-personality-select" style="width: 100%; padding: 8px; margin-bottom: 8px; background: var(--SmartThemeBodyColor); color: var(--SmartThemeEmColor); border: 1px solid #444; border-radius: 4px;">
                    <option value="default">🐱 默认 - 高冷但温柔的猫</option>
                    <option value="cheerful">🐶 活泼 - 热情洋溢的小狗</option>
                    <option value="elegant">🐉 优雅 - 古典文雅的龙</option>
                    <option value="shy">🐰 害羞 - 轻声细语的兔子</option>
                    <option value="smart">🐦 聪明 - 机智幽默的鸟</option>
                    <option value="custom">✏️ 自定义人设</option>
                </select>
            </div>

            <div id="virtual-pet-custom-personality-container" style="display: none; margin-top: 10px;">
                <label for="virtual-pet-custom-personality" style="display: block; margin-bottom: 5px; font-size: 0.9em;">
                    自定义人设描述：
                </label>
                <textarea id="virtual-pet-custom-personality"
                          placeholder="描述你的宠物性格、喜好和特点..."
                          rows="3"
                          maxlength="500"
                          style="width: 100%; padding: 8px; background: var(--SmartThemeBodyColor); color: var(--SmartThemeEmColor); border: 1px solid #444; border-radius: 4px; resize: vertical; font-family: inherit;"></textarea>
                <small style="color: #888; font-size: 0.8em;">最多500字符，这将影响宠物与你互动时的回复风格</small>
            </div>

            <small class="notes" style="margin-top: 10px; display: block;">
                选择或自定义宠物的性格，AI会根据人设生成个性化回复
            </small>

            <hr style="margin: 15px 0; border: none; border-top: 1px solid #444;">

            <!-- API配置 -->
            <div class="flex-container">
                <label for="virtual-pet-api-mode-select" style="display: block; margin-bottom: 8px; font-weight: bold;">
                    🔗 API集成模式
                </label>
                <select id="virtual-pet-api-mode-select" class="text_pole" style="width: 100%;">
                    <option value="auto">🤖 智能集成 (推荐) - 自动使用SillyTavern的API配置</option>
                    <option value="native">🏠 原生调用 - 直接使用SillyTavern的生成函数</option>
                    <option value="manual">⚙️ 手动配置 - 自定义API端点</option>
                </select>
            </div>

            <!-- 手动配置选项 -->
            <div id="virtual-pet-manual-config" style="display: none; margin-top: 15px; padding: 10px; background: rgba(255, 193, 7, 0.1); border-radius: 4px; border-left: 4px solid #ffc107;">
                <div style="margin-bottom: 10px;">
                    <label for="virtual-pet-api-endpoint-select" style="display: block; margin-bottom: 5px; font-weight: bold;">
                        API端点选择
                    </label>
                    <select id="virtual-pet-api-endpoint-select" class="text_pole" style="width: 100%;">
                        <option value="/api/v1/generate">📡 /api/v1/generate (Text Generation WebUI)</option>
                        <option value="/api/generate">📡 /api/generate (KoboldAI)</option>
                        <option value="/v1/chat/completions">📡 /v1/chat/completions (OpenAI Chat)</option>
                        <option value="/v1/completions">📡 /v1/completions (OpenAI Completions)</option>
                        <option value="/completions">📡 /completions (简化版)</option>
                        <option value="custom">✏️ 自定义端点</option>
                    </select>
                </div>

                <div id="virtual-pet-custom-api-container" style="display: none;">
                    <label for="virtual-pet-custom-api-url" style="display: block; margin-bottom: 5px;">
                        自定义API端点URL
                    </label>
                    <input type="text" id="virtual-pet-custom-api-url" class="text_pole"
                           placeholder="例如: /api/custom/generate"
                           style="font-family: monospace;">
                    <small style="color: #888; font-size: 0.8em; display: block; margin-top: 5px;">
                        输入完整的API路径，例如 /api/v2/generate
                    </small>
                </div>
            </div>

            <!-- API状态和测试 -->
            <div style="margin-top: 15px;">
                <div class="flex-container" style="gap: 10px;">
                    <button id="virtual-pet-test-api" class="menu_button" style="flex: 1;">
                        🧪 测试API连接
                    </button>
                    <button id="virtual-pet-refresh-config" class="menu_button" style="flex: 1;">
                        🔄 刷新配置
                    </button>
                </div>

                <div class="flex-container" style="gap: 10px; margin-top: 5px;">
                    <button id="virtual-pet-show-debug" class="menu_button menu_button_icon" style="flex: 1;">
                        <i class="fa-solid fa-bug"></i>
                        <span>调试信息</span>
                    </button>
                </div>
            </div>

            <!-- 调试信息面板 -->
            <div id="virtual-pet-debug-info" style="display: none; margin-top: 10px;">
                <div class="inline-drawer">
                    <div class="inline-drawer-toggle inline-drawer-header" style="background: rgba(23, 162, 184, 0.1);">
                        <b>🔍 调试信息</b>
                        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
                    </div>
                    <div class="inline-drawer-content">
                        <div id="virtual-pet-debug-content" style="font-family: monospace; font-size: 0.8em; background: #1a1a1a; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto; white-space: pre-wrap;">
                            点击"测试API连接"或"刷新配置"查看详细信息...
                        </div>
                    </div>
                </div>
            </div>

            <small class="notes" style="margin-top: 10px; display: block;">
                <strong>智能集成</strong>会自动检测并使用SillyTavern的当前API配置。<br>
                <strong>原生调用</strong>直接使用SillyTavern的内置生成函数，兼容性最好。<br>
                <strong>手动配置</strong>允许您指定特定的API端点，适用于特殊需求。
            </small>

            <hr style="margin: 15px 0; border: none; border-top: 1px solid #444;">

            <!-- 关于信息 -->
            <div style="margin-top: 15px; padding: 10px; background: rgba(255, 158, 199, 0.1); border-radius: 4px; border-left: 4px solid #FF9EC7;">
                <div style="font-weight: bold; margin-bottom: 5px;">🐾 关于虚拟宠物系统</div>
                <div style="font-size: 0.9em; color: #888;">
                    这是一个智能的虚拟宠物扩展，能够：<br>
                    • 🤖 自动探测SillyTavern的API配置<br>
                    • 🎭 支持多种人设和自定义性格<br>
                    • 💬 生成个性化的AI回复<br>
                    • 🎨 可拖动的糖果色界面<br>
                    <br>
                    <small>版本 2.0 | 兼容SillyTavern标准扩展API</small>
                </div>
            </div>
        </div>
    </div>
</div>
